steps:
- name: 'gcr.io/cloud-builders/docker'
  entrypoint: 'bash'
  args: ['-c', 'docker pull ${_LOCATION}-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY}/gcp-alerts-discord-webhook:${_VERSION} || exit 0']
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', '${_LOCATION}-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY}/gcp-alerts-discord-webhook:${_VERSION}', '--cache-from', '${_LOCATION}-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY}/gcp-alerts-discord-webhook:${_VERSION}', '.']

substitutions:
  _REPOSITORY: gcp-alerts-discord-webhook
  _LOCATION: europe-west1
  _VERSION: latest

images:
- '${_LOCATION}-docker.pkg.dev/$PROJECT_ID/${_REPOSITORY}/gcp-alerts-discord-webhook:${_VERSION}'
